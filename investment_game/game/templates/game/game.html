{% extends 'game/base.html' %}
{% block title %}Игра - Неделя {{ game_session.current_week }}{% endblock %}

{% block content %}
<div class="card">
    <h2>Неделя {{ game_session.current_week }} из {{ game_session.total_weeks }}</h2>
    
    <div class="capital-display">
        Текущий капитал: {{ game_session.current_capital|floatformat:2 }}₽
        {% if game_session.current_week > 1 %}
        <small style="color: #666; font-size: 1rem;">
            (Изначально: {{ game_session.initial_capital|floatformat:2 }}₽)
        </small>
        {% endif %}
    </div>

    {% if not game_session.is_finished %}
        <div style="display: flex; gap: 1rem; margin: 1rem 0;">
            <a href="{% url 'invest' %}" class="btn">Распределить инвестиции</a>
            <form method="post" style="display: inline;">
                {% csrf_token %}
                <button type="submit" name="next_week" class="btn btn-success">
                    Следующая неделя
                </button>
            </form>
        </div>
    {% else %}
        <div class="card" style="background: #e8f5e8;">
            <h3>Игра завершена!</h3>
            <p>Ваш финальный капитал: {{ game_session.current_capital|floatformat:2 }}₽</p>
            <a href="{% url 'results' %}" class="btn">Посмотреть результаты</a>
            <a href="{% url 'new_game' %}" class="btn btn-success">Новая игра</a>
        </div>
    {% endif %}
</div>

<div class="card">
    <h3>Ваши инвестиции</h3>
    <div class="investment-grid">
        {% for investment in investments %}
        <div class="investment-card">
            <h4>{{ investment.instrument.name }}</h4>
            <p><strong>Тип:</strong> {{ investment.instrument.get_instrument_type_display }}</p>
            <p><strong>Сумма:</strong> {{ investment.amount|floatformat:2 }}₽</p>
            <p><strong>Доходность:</strong> {{ investment.instrument.base_return }}%</p>
            <p><strong>Риск:</strong> {{ investment.instrument.get_risk_level_display }}</p>
        </div>
        {% empty %}
        <p>У вас пока нет инвестиций. <a href="{% url 'invest' %}">Добавьте их!</a></p>
        {% endfor %}
    </div>
</div>

{% if turns %}
<div class="card">
    <h3>История недель</h3>
    {% for turn in turns %}
    <div style="border-bottom: 1px solid #eee; padding: 0.5rem 0;">
        <strong>Неделя {{ turn.week_number }}:</strong>
        {{ turn.capital_before|floatformat:2 }}₽ → {{ turn.capital_after|floatformat:2 }}₽
        {% if turn.event %}
            <br><small>Событие: {{ turn.event.name }} ({{ turn.event.get_event_type_display }})</small>
        {% endif %}
    </div>
    {% endfor %}
</div>
{% endif %}
{% endblock %}