{% extends 'base.html' %}
{% block title %}Игра — Расти с ВТБ{% endblock %}

{% block content %}
<div class="custom-card">

  <h3>Неделя {{ game_session.current_week }} из {{ game_session.total_weeks }}</h3>
  <p>Текущий капитал: <strong>{{ game_session.current_capital }} ₽</strong></p>

  <a href="{% url 'game:invest' %}" class="btn vtb-btn mb-3">Распределить инвестиции</a>

  <form method="post">
    {% csrf_token %}
    <button type="submit" name="next_week" class="btn btn-outline-secondary">Следующая неделя</button>
  </form>

  <hr>

  <h4>Текущие инвестиции</h4>
  <table class="table table-striped">
    <thead>
      <tr>
        <th>Инструмент</th>
        <th>Сумма</th>
        <th>Доходность</th>
        <th>Риск</th>
      </tr>
    </thead>
    <tbody>
      {% for inv in investments %}
      <tr>
        <td>{{ inv.instrument.name }}</td>
        <td>{{ inv.amount }} ₽</td>
        <td>{{ inv.instrument.base_return }}%</td>
        <td>{{ inv.instrument.risk_level }}</td>
      </tr>
      {% endfor %}
    </tbody>
  </table>

  <h4 class="mt-4">История ходов</h4>
  <table class="table">
    <thead>
      <tr>
        <th>Неделя</th>
        <th>Событие</th>
        <th>Капитал до</th>
        <th>Капитал после</th>
        <th>Δ</th>
      </tr>
    </thead>
    <tbody>
    {% for t in turns %}
      <tr>
        <td>{{ t.week_number }}</td>
        <td>{{ t.event.name }}</td>
        <td>{{ t.capital_before }} ₽</td>
        <td>{{ t.capital_after }} ₽</td>
        <td>{{ t.capital_after|floatformat:2|add:"- "|add:t.capital_before|floatformat:2 }}</td>
      </tr>
    {% endfor %}
    </tbody>
  </table>

</div>
{% endblock %}
